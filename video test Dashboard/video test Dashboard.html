<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="generator" content="Google Web Designer 16.1.0.0530">
  <meta name="template" content="Banner 3.0.0">
  <meta name="environment" content="gwd-dv360">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="gwdpage_style.css" rel="stylesheet" data-version="13" data-exports-type="gwd-page">
  <link href="gwdpagedeck_style.css" rel="stylesheet" data-version="14" data-exports-type="gwd-pagedeck">
  <link href="gwdgooglead_style.css" rel="stylesheet" data-version="9" data-exports-type="gwd-google-ad">
  <link href="gwdvideo_style.css" rel="stylesheet" data-version="19" data-exports-type="gwd-video">
  <link href="gwdimage_style.css" rel="stylesheet" data-version="17" data-exports-type="gwd-image">
  <link href="gwdtaparea_style.css" rel="stylesheet" data-version="7" data-exports-type="gwd-taparea">
  <style id="gwd-lightbox-style">
    .gwd-lightbox {
      overflow: hidden;
    }
  </style>
  <style id="gwd-text-style">
    p {
      margin: 0px;
    }
    h1 {
      margin: 0px;
    }
    h2 {
      margin: 0px;
    }
    h3 {
      margin: 0px;
    }
  </style>
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
    }
    .gwd-page-container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .gwd-page-content {
      background-color: transparent;
      transform: perspective(1400px) matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      position: absolute;
      transform-style: preserve-3d;
    }
    .gwd-page-content * {
      transform-style: preserve-3d;
    }
    .gwd-page-wrapper {
      background-color: rgb(255, 255, 255);
      position: absolute;
      transform: translateZ(0px);
    }
    .gwd-page-size {
      width: 300px;
      height: 250px;
    }
    .gwd-video-kq5h {
      position: absolute;
      left: 0px;
      transform-origin: 50% 50% 0px;
      top: 0px;
      height: 250px;
      width: 300px;
    }
    .gwd-image-12gq {
      height: 13px;
      transform-origin: 10px 6.5px 0px;
    }
    .gwd-image-zn5z {
      width: 20px;
      height: 13px;
    }
    .gwd-image-19fk {
      position: absolute;
      top: 0px;
      left: 0px;
    }
    .gwd-image-kp2l {
      width: 100px;
      height: 26.92px;
    }
    .gwd-image-8bqo {
      position: absolute;
      top: 199px;
      left: 100px;
      transform: scale3d(1, 1, 1);
    }
    @keyframes gwd-gen-dxilgwdanimation_gwd-keyframes {
      0% {
        transform: scale3d(1, 1, 1);
        animation-timing-function: linear;
      }
      50% {
        transform: scale3d(1.1, 1.1, 1.1);
        animation-timing-function: linear;
      }
      100% {
        transform: scale3d(1, 1, 1);
        animation-timing-function: linear;
      }
    }
    #page1.gwd-play-animation .gwd-gen-dxilgwdanimation {
      animation: 1s linear 0s infinite normal forwards running gwd-gen-dxilgwdanimation_gwd-keyframes;
    }
    .gwd-taparea-1esa {
      position: absolute;
      left: 100px;
      transform-origin: 50% 50% 0px;
      top: 200px;
      width: 100px;
      height: 27px;
    }
  </style>
  <script data-source="gwd_webcomponents_v1_min.js" data-version="2" data-exports-type="gwd_webcomponents_v1" src="gwd_webcomponents_v1_min.js"></script>
  <script data-source="gwdpage_min.js" data-version="13" data-exports-type="gwd-page" src="gwdpage_min.js"></script>
  <script data-source="gwdpagedeck_min.js" data-version="14" data-exports-type="gwd-pagedeck" src="gwdpagedeck_min.js"></script>
  <script data-source="https://s0.2mdn.net/ads/studio/Enabler.js" data-exports-type="gwd-google-ad" src="https://s0.2mdn.net/ads/studio/Enabler.js"></script>
  <script data-source="gwdgooglead_min.js" data-version="9" data-exports-type="gwd-google-ad" src="gwdgooglead_min.js"></script>
  <script data-source="gwdvideo_min.js" data-version="19" data-exports-type="gwd-video" src="gwdvideo_min.js"></script>
  <script data-source="gwdimage_min.js" data-version="17" data-exports-type="gwd-image" src="gwdimage_min.js"></script>
  <script data-source="gwdtaparea_min.js" data-version="7" data-exports-type="gwd-taparea" src="gwdtaparea_min.js"></script>
  <script type="text/javascript" gwd-events="support" src="gwd-events-support.1.0.js"></script>
  <script type="text/javascript" gwd-events="handlers">
    window.gwd = window.gwd || {};

   
  
 
    gwd.click = function(event) {
      
      window.open('https://digitaltribe.com.ng/', '_blank')
      
    };
  </script>
  <script type="text/javascript" gwd-events="registration">
    // Support code for event handling in Google Web Designer
    // This script block is auto-generated. Please do not edit!
    gwd.actions.events.registerEventHandlers = function(event) {
      gwd.actions.events.addHandler('gwd-taparea_1', 'action', gwd.click, false);
    };
    gwd.actions.events.deregisterEventHandlers = function(event) {
      gwd.actions.events.removeHandler('gwd-taparea_1', 'action', gwd.click, false);
    };
    document.addEventListener("DOMContentLoaded", gwd.actions.events.registerEventHandlers);
    document.addEventListener("unload", gwd.actions.events.deregisterEventHandlers);
  </script>
</head>

<body>
  <gwd-google-ad id="gwd-ad" polite-load="">
    <gwd-metric-configuration>
      <gwd-metric-event source="gwd-taparea_1" event="tapareaexit" metric="" exit="Exit"></gwd-metric-event>
    </gwd-metric-configuration>
    <gwd-pagedeck class="gwd-page-container" id="pagedeck">
      <gwd-page id="page1" class="gwd-page-wrapper gwd-page-size gwd-lightbox" data-gwd-width="300px" data-gwd-height="250px">
        <div class="gwd-page-content gwd-page-size">
       <gwd-video controls = "" muted="" sources="assets/WhatsApp Video 2024-12-10 at 4.28.42 PM.mp4" id="gwd-video_1" class="gwd-video-kq5h" autoplay=""></gwd-video>
          <gwd-image source="assets/dtlogo.png" scaling="stretch" id="dtlogo_10" class="gwd-image-12gq gwd-image-zn5z gwd-image-19fk"></gwd-image>
          <gwd-image source="assets/learn_more_gino.png" scaling="stretch" id="learn_more_gino" class="gwd-image-kp2l gwd-image-8bqo gwd-gen-dxilgwdanimation"></gwd-image>
          <gwd-taparea id="gwd-taparea_1" class="gwd-taparea-1esa"></gwd-taparea>
        </div>
      </gwd-page>
    </gwd-pagedeck>
  </gwd-google-ad>
  <script type="text/javascript" id="gwd-init-code">
    (function() {
      var gwdAd = document.getElementById('gwd-ad');

      /**
       * Handles the DOMContentLoaded event. The DOMContentLoaded event is
       * fired when the document has been completely loaded and parsed.
       */
      function handleDomContentLoaded(event) {

      }

      /**
       * Handles the WebComponentsReady event. This event is fired when all
       * custom elements have been registered and upgraded.
       */
      function handleWebComponentsReady(event) {
        // Start the Ad lifecycle.
        requestAnimationFrame(function() {
          setTimeout(function() {
            gwdAd.initAd();
          }, 1);
        });
      }

      /**
       * Handles the event that is dispatched after the Ad has been
       * initialized and before the default page of the Ad is shown.
       */
      function handleAdInitialized(event) {}

      window.addEventListener('DOMContentLoaded',
        handleDomContentLoaded, false);
      window.addEventListener('WebComponentsReady',
        handleWebComponentsReady, false);
      window.addEventListener('adinitialized',
        handleAdInitialized, false);
    })();


   const socket  = new WebSocket('ws://localhost:8080');


    const videoElement = document.getElementById('gwd-video_1')
    let dailyData = {
     imp: Number(localStorage.getItem('impressions')) || 0,
      clicks: Number(localStorage.getItem('clicks')) || 0,
      reach:Number(localStorage.getItem('reach')) || 0,
      ctr:Number(localStorage.getItem('ctr')) || 0,
      firstQuartile:Number(localStorage.getItem('firstQuartileCount')) || 0,
      midpoint:Number(localStorage.getItem('midpointCount')) || 0,
      thirdquartile:Number(localStorage.getItem('thirdQuartileCount')) || 0,
      videoStart:Number(localStorage.getItem('videoStartCount')) || 0,
      pause:Number(localStorage.getItem('videoPauseCount')) || 0,
      unmute:Number(localStorage.getItem('videoUnmuteCount')) || 0,
      completed:Number(localStorage.getItem('videoCompletedCount')) || 0,
      viewableImpressions:Number(localStorage.getItem('viewableImpressionsCount')) || 0
}

function trackVideoViewableImpression(videoElementId) {
  let hasCountedViewableImpression = false;

  function isElementInViewport(el) {
    const rect = el.getBoundingClientRect();
    return (
      rect.top >= 0 &&
      rect.left >= 0 &&
      rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
      rect.right <= (window.innerWidth || document.documentElement.clientWidth)
    );
  }

  function checkViewability() {
   

    if (videoElement && isElementInViewport(videoElement) && document.visibilityState === 'visible') {
      if (!hasCountedViewableImpression) {
        console.log('Viewable video impression recorded');
        hasCountedViewableImpression = true;

        // Add viewable impression to daily data
        dailyData.viewableImpressions = (dailyData.viewableImpressions || 0) + 1;
      }
    }
  }

  // Check viewability on scroll and visibility change
  window.addEventListener('scroll', checkViewability);
  document.addEventListener('visibilitychange', checkViewability);

  // Initial check
  checkViewability();
}

// Call the function with your video element ID
trackVideoViewableImpression('gwd-video_1');

/*function getOrSetSessionId(){
  let sessionId = sessionStorage.getItem('sessionId')
  if(!sessionId){
    sessionId = `session_${Math.random().toString(36).substr(2, 9)}`
  }
  return sessionId
}*/



/*const sessionId = getOrSetSessionId()
dailyData.sessionId = sessionId 
function sendDailyData() {
  if (socket.readyState === WebSocket.OPEN) {
    socket.send(JSON.stringify({sessionId,...dailyData}));
    console.log('Data sent to server:', dailyData);
  }
}
*/


/*function getOrSetSessionId(){
  const storedSession = sessionStorage.getItem('sessionData')
  const todayDate = new Date().toISOString().split('T')[0];
  if(storedSession){
    const sessionInfo =JSON.parse(storedSession);
    if(sessionInfo.date === todayDate){
      return sessionInfo.sessionId
    }
  }

  //Generate new session ID if date is different 
  const newsessionId =  `session_${Math.random().toString(36).substr(2, 9)}`;
  sessionStorage.setItem('sessionData', JSON.stringify({sessionId:newsessionId,date: todayDate }))
  return newsessionId;

}
const sessionId = getOrSetSessionId()
dailyData.sessionId = sessionId

// function to to send daily data (once per day)

function sendDailyData(){
  const lastSentDate = localStorage.getItem('lastSentDate')
  const todayDate = new Date().toISOString().split('T')[0]

  // only send data if  not alread sent today 
if(lastSentDate !== todayDate && socket.readyState === WebSocket.OPEN ){
  socket.send(JSON.stringify({sessionId, ...dailyData}))
  console.log('Data sent to server:', dailyData)
  localStorage.setItem('lastSentDate', todayDate)
}else{
  console.log('Data already sent today. Skipping...')
}

}*/

/*function sendDailyData() {
  if (socket.readyState === WebSocket.OPEN) {
    socket.send(JSON.stringify(dailyData));
    //console.log('Daily data sent to server:', dailyData);
  } else {
    console.error('WebSocket is not open. Data not sent.');
  }
}

// Send data every 60 seconds
sendDailyData()*/

let hasSentData = false;


socket.onopen = () => {
  console.log('WebSocket connection established âœ…');
  sendDailyData(); // Send data once connection is open
};

socket.onerror = (error) => {
  console.error('WebSocket error:', error);
};

socket.onclose = () => {
  console.warn('WebSocket connection closed. Trying to reconnect...');
  // Optional: Reconnect logic
};

function sendDailyData() {
  if (hasSentData) {
    console.log('Daily data has already been sent. Skipping...');
    return;
  }

  if (socket.readyState === WebSocket.OPEN) {
    socket.send(JSON.stringify(dailyData));
    console.log('Daily data sent to server:', dailyData);

    // Set the flag to prevent resending
    hasSentData = true;
  } else {
    console.error('WebSocket is not open. Data not sent.');
  }
}
sendDailyData()






//flags
let tracked = {
  start:false,
  firstQuartile:false,
  midpoint:false,
  thirdquartile:false,
  completed:false
}

let hasCountedImpression = false;
let hasCountedClick = false;
let hasCountedStart = false;

let quartiles = {
  first:false,
  midpoint:false,
  third:false,
  completed:false

}
    function trackImpressions(){
      if(!hasCountedImpression){
        dailyData.imp++
      localStorage.setItem('impressions', dailyData.imp)
      console.log('impressions recorded',dailyData.imp)
      }
     
    }
    trackImpressions()

    function trackClicks(event) {
      if(!hasCountedClick){
        dailyData.clicks++;
  localStorage.setItem('clicks', dailyData.clicks);
  console.log('Clicks recorded:', dailyData.clicks);
      }
 

  // Open URL in a new tab
  setTimeout(() => {
    window.open('https://digitaltribe.com.ng/', '_blank');
  }, 100); // Delay to ensure click is recorded
}

// Ensure the click event is properly registered
document.addEventListener("DOMContentLoaded", function () {
  const tapArea = document.getElementById('gwd-taparea_1');

  if (tapArea) {
    tapArea.addEventListener("click", trackClicks);
  } else {
    console.error("Tap area not found!");
  }
});

    function resetdailyData(){
      localStorage.removeItem('impressions')
      dailyData.imp = 0;
      localStorage.removeItem('clicks')
      dailyData.clicks = 0;
      localStorage.removeItem('firstQuartileCount')
      dailyData.firstQuartile = 0;
      localStorage.removeItem('midpointCount')
      dailyData.midpoint = 0;
      localStorage.removeItem('thirdQuartileCount')
      dailyData.thirdquartile = 0;
      localStorage.removeItem('videoStartCount')
      dailyData.videoStart = 0;
      localStorage.removeItem('videoPauseCount')
      dailyData.pause = 0;
      localStorage.removeItem('videoUnmuteCount')
      dailyData.unmute = 0;
      localStorage.removeItem('videoCompletedCount')
      dailyData.completed = 0;
      localStorage.removeItem('reach')
      dailyData.reach = 0;
      localStorage.removeItem('viewableImpressionsCount')
      dailyData.viewableImpressions = 0
      dailyData.firstQuartile = 0;
      console.log('Daily data refresh', dailyData)
    }

  

 console.log('Dailydata:', dailyData)

  // function for calculating reach

  // function for reach
const uniqueUsers = new Set()

function recordview(userId){
  uniqueUsers.add(userId)
  dailyData.reach = uniqueUsers.size;
  dailyData.reach++
 //console.log(`Reach: ${dailyData.reach}`)
}
  function getOrSetUserCookie(){
    const cookieName = 'bannerUserId'
    let userId = getCookie(cookieName)
    if(!userId){
      userId = `user_${Math.random().toString(36).substr(2, 9)}`
      setCookie(cookieName,userId,30)
    }
    return userId;
  }


  function getCookie(name){
    const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(";").shift();
  }

  function setCookie(name, value, days){
    const date = new Date();
    date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000)
    document.cookie = `${name}=${value}; expires=${date.toUTCString()}; path=/`
}

  function recordBannerview(){
    const userId = getOrSetUserCookie()
    recordview(userId)
  }

  recordBannerview()
const videoDuration = videoElement.duration
videoElement.addEventListener('loadedmetadata',()=>{
let firstQuartile = videoElement.duration * 0.25;
let midpoint = videoElement.duration * 0.50;
let thirdquartile = videoElement.duration * 0.75;
let completed = videoElement.duration * 0.98;


videoElement.addEventListener("timeupdate", ()=>{
  const currentTime = videoElement.currentTime
  if(!hasCountedStart && !tracked.start && currentTime > 0){
    dailyData.videoStart++;
    localStorage.setItem("videoStartCount", dailyData.videoStart)
    console.log("video Started Count", dailyData.videoStart)
    tracked.start = true;
  }

  if(!tracked.firstQuartile && currentTime >= firstQuartile && !quartiles.first){
    dailyData.firstQuartile++;
    localStorage.setItem('firstQuartileCount', dailyData.firstQuartile);
    console.log('First quartile count:', dailyData.firstQuartile);
    tracked.firstQuartile = true;
  }
  if(!tracked.midpoint && currentTime >= midpoint && !quartiles.midpoint){
  dailyData.midpoint++;
  localStorage.setItem("midpointCount", dailyData.midpoint)
  tracked.midpoint = true;
}

if(!tracked.thirdquartile && currentTime >= thirdquartile && !quartiles.third){
  dailyData.thirdquartile++;
  localStorage.setItem("thirdQuartileCount", dailyData.thirdquartile);
  tracked.thirdquartile = true;
}
if(!tracked.completed && currentTime >= completed){
  dailyData.completed++
  localStorage.setItem('videoCompletedCount',dailyData.completed && !quartiles.completed)
  tracked.completed = true;
}
})
videoElement.addEventListener("pause",()=>{
  dailyData.pause++;
  localStorage.setItem("videoPauseCount", dailyData.pause);
  console.log("Pause Count:", dailyData.pause)
});

videoElement.addEventListener("volumechange", ()=>{
  if(videoElement.muted){
    dailyData.unmute++;
    localStorage.setItem("videoUnmuteCount", dailyData.unmute);
    console.log("Mute count:", dailyData.unmute)
  }
})


})

console.log('Daily data:', dailyData)

//calculating viewability rate 

const options = {
  root:null,
  threshold:0.5,// trigger when 50% of the ad is visible
}
 
const callback =(entries, observer)=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){
      console.log('Ad is viewable')
      dailyData.viewableImpressions++
    }
  })
}
const observer = new IntersectionObserver(callback,options)
observer.observe(videoElement)
  //video metrics


  </script>



  
</body>

</html>